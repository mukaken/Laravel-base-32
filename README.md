Laravel-base-32
===============

Sample and development base of Laravel ver. 3.2

### twitter-bootstrapバージョン

Laravel 3.2.12

Laravel ver.3.2のサンプルです。実際の動作を見ながら、コードを確認していただくために、公開します。開発のベースとして使用できるように、設定をしています。詳細は[Laravel開発ベースサンプル](http://kore1server.com/laravel-tutorial/312-laravel-32-development-base-sample.html)をご覧ください。

twitter-bootstrapブランチは、その名の通りtwitter bootstrapを使用したバージョンです。twitter bootstrapをベースに利用する場合のために、用意しました。コードがやや複雑になりますので、学習目的やbootstarpを使用しない開発のベースには、original-cssブランチをご利用ください。コードがすっきりとしており、分かりやすくなっています。

特徴
====

* デモページ、エラーページを翻訳してあります。
* 日本語ドキュメントも同包しております。更新は遅れ気味になりますので、最新版は、[こちら](http://laravel.kore1server.com)をご覧ください。もしくは、電子書籍版をご購入ください。
* IDEでの補完用コード(application/ccc.php)を用意しております。
*以下のサンプルコードとして、利用していただけるでしょう。
  * 多国語対応
  * Form Base Model（バンドル）の使用法
  * 設定(config)ファイルの環境による使い分け
  * 設定ファイルで無名関数を使用する
  * 開発／実働環境でのエラー表示・ログの使い分け
* 使用しているバンドルは、デフォルトで含まれているdocs（改造してあるため、原型を留めていません）、Form Base Model（バンドル公式リポジトリーからインストールしたものです）です。Pagechachバンドルは私が作成したものですが、単純ですから、バンドル作成のひな形としても利用できます。
* 動作環境のチェックプログラムをpublicの下、checkerディレクトリーに追加してあります。インストール後にアクセスしてチェックしていただくことも可能ですし、checkerディレクトリーのみアップロードし、ホストの動作環境をチェックするためにも、使用できます。
* ブラウザの言語設定により、表示言語を設定するように変更してあります。application/config/application.phpの一番最初に追加したコードです。application/config/language.php設定ファイルを追加し、この中でサポート言語と、サポート言語の中にブラウザで指定してある言語が見つからない場合に使用するフォールバッグ言語を指定します。
* コマンドラインツールのArtisanをブラウザ経由で実行できるようにしてあります。public/commandにアクセスしてください。これは、共有サーバーやPaSSなどを使用する場合、端末操作が許されない場合のために、付け加えました。セキュリティ的には大きな穴になりますので、実働環境では、無効にしてください。

インストール方法
================

1. このリポジトリをクローンするか、もしくはzipで落としてください。コアはたまにしか更新しません。Laravelの最新版を使用したい方は、自分でLaravelの最新バージョンのlaravelディレクトリーを上書きしたほうが、大抵の場合早いです。
2. storageディレクトリー以下を書き込めるようにパーミッションを設定してください。
3. application/configとapplication/config/local下にあるdatabase.phpを変更してください。MySQL使用の前提にして有りますが、他のストレージでも動作するでしょう。とりあえず、最初は両方とも同じ設定にしておくと、はまらないですみます。続いて、設定に合わせ、ストレージの準備を行なってください。（MySQLでしたら、DBを作成し、必要に応じユーザーを作成、権限をつけます。）
4. インストールしたディレクトリー（フォルダー）で端末（ターミナル、cmd.exeなど）を開き、`php artisan migrate:install`を実行します。
5. 続いて、`php artisan migrate`を実行します。
6. ブラウザからpublicへアクセスしてください。トップページが表示されます。
7. <http://kore1server.com/tutorial/laravel/312-laravel-32-development-base-sample>と<http://kore1server.com/tutorial/laravel/316-development-base-bootstrap-version>を参照し、残りの設定を行なってください。
8. 初めてLaravelを使用される方は、public/checker/checker.phpへアクセスし、動作環境をチェックすることをおすすめします。PHPモジュールの不足等を確認できます。PHPモジュールは足りなくても、それを使用する機能を使用しなければ動作します。

統合環境コード補完用コード生成コマンド
======================================

統合環境では、クラスやメソッドの補完が利用できるものが多いです。しかし最近の小型フレームワークでは、統合環境よりも、テキストエディターで作成しやすくするため、クラス名の省略形を使用しています。そのため、統合環境を使用するメリットである、コードの補完が上手く働きません。

補完を行わせるため、省略名とメソッドの定義元のクラスを定義付ける、ダミーコードを利用すれば、補完を上手く行うことができます。そのダミーコードを生成するLaravelのタスクを追加してあります。

	// 生成コードを端末で確認
	php artisan ccc

	// 生成コードをapplication/ccc.phpへ保存
	php artisan ccc:save

この生成プログラムはapplication/config下に設定されてるファイル中で指定された、ドライバーの種類を元にクラスエイリアスを設定します。そのため、ドライバーの種類を変更した場合は、生成し直してください。なお、URLにより判定されるLaravelの環境は判断しておりません。configディレクトリー直下のファイル中の設定のみ、生成に利用しております。

例外メッセージ日本語化コマンド
==============================

Laravelが発生させる例外のメッセージを日本語化するコマンドです。できるだけ日本語で開発したい方、もしくはPHP教育にLaravelを使用される方などは、日本語でメッセージが表示されたほうがよろしいかと思いまして作成しました。

laravel-jaフォルダーが生成されます。オリジナルのlaravelフォルダーをlaravel-enなどにリネームし、laravel-jaをlaravelへリネームしてください。

コマンドラインのメッセージで日本語が表示できない場合、メッセージが文字化けします。コマンドラインを多用する方は、自分でPHPやコマンドラインの設定が可能な方を除き、日本語化は行わないほうがよろしいでしょう。

	// 例外メッセージ日本語置換実行
	php artisan japanize

Laravel実行環境判定
===================

多くのCMSやWebプログラムは、動作が正しく行われるか確認するためのチェッカーを用意していたり、インストールの最初に実行される仕組みになっております。

Laravelにはこのユーティリティが用意されていないため、独自に開発しました。

１．Laravelインストール前にチェックを行う

サーバーにpublic/checkerフォルダーをアップロードしてください。次にブラウザからアップしたサーバーのURLのchecker/checker.phpへアクセスしてください。結果が表示されます。

２．Laravelインストール後にチェックを行う

サーバーにこの開発ベースをアップし、設定してください。次にchecker/checker.phpもしくはpublic/checker/checker.phpにアクセスしてください。

Laravelの場合、必要なPHPエクステンションなどの説明がドキュメントに上手くまとまっていません。一応、公式ドキュメントで動作に必要だと明記されている項目は赤字、明記されていないが必要に応じインストールすべきものは黄色（茶色）で表示しています。ただし、赤で表示される項目であっても、それを使用する機能を使用しない場合は、インストールされていなくても動作します。例えば、認証や暗号化、セッションなどを使用せず、表示だけを行うサイトであれば、動作要件に指定されているMcryptさえなくても動作します。あくまで、どの機能を使用するかを考慮して、判断してください。

ユニットテストの強化
====================

Laravelのコマンドラインを利用してテストする場合、次の利点があります。

* 自動的にブートストラップコードを読み込むため、テストコードはLaravelの環境で実行される。余計なincludeを行う必要はない。

逆に欠点は以下のとおりです。

* phpunitの機能が十分に使用できない。例えば：
  * application/tests以下の.test.phpファイルのみが処理され、サブフォルダー下までテストファイルを探しに行かない。
  * ファイル名が.test.phpと固定される。
  * スケルトンジェネレーターが生成するファイルの命名規則と異なるため、いちいち名前を変更しなくてはならない。

LaravelのコマンドラインArtisanからPHPUnitを実行しても、機能を十分に生かせませんし、不便な部分が多いですから、直接phpunitで実行しましょう。そのために、以降の工夫がしてあります。

phpunitの環境ファイルphpunit.xml.distをルートへ追加してあります。これによりコマンドラインのパラメーターを指定せずとも"phpunit"を実行すれば、テストが実行されます。artisanを利用してテストするより、簡単で柔軟性があります。

xmlファイルを読んでいただけば、設定内容は一目瞭然です。コメントも入れてあります。

多少注意が必要なのは、directoryのsufiixの指定です。これによりテストを記述しているファイルのサフィックスを指定してあります。スケルトンジェネレータが生成する"Test.php"に設定してあります。もし、Laravelのテストファイルの命名規則と合わせたい場合は".test.php"に変更してください。

設定ファイル中ではカバーレージの対象も設定してありますが、テストのみの目的であれば、指定をしなくても動作します。

NetBeansで実行する場合、プロジェクトのPHPUnitの項目で、「XML構成の使用」にチェックを入れ、このファイルを指定してもらうと、ブートストラップの設定とカバーレージ範囲も指定されるので、大変便利です。
